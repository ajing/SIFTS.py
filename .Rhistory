      
      oddsratio_fun <- function(d, i) {
        or <- fisher.test(table(data.frame(residueName = (d[i,interested_par] == each), Disease = d[i, "VarType"] == vartype)))$estimate[[1]]
        or
      }
      
      oddsboot <- tryCatch({
        boot(p_annotate_bs, oddsratio_fun, R = 100, parallel = "multicore")
        
      }, error = function(err) { cannot_proc <<- T })
      
      oddsci   <- tryCatch({
        boot.ci(oddsboot, type = "norm")
      }, error = function(err) { cannot_proc <<- T })
      
      if (cannot_proc) {
        next
      }
      
      print(oddsci)
      
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"estimate"] = oddsci$t0
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"ci_low"] = oddsci$normal[2]
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"ci_up"] = oddsci$normal[3]
    }
  }
  
  print(ratio_amino)
  # plot the graph
  ratio_amino_sort <- ratio_amino[with(ratio_amino, order(-estimate)),]
  ratio_amino[, interested_par] <- factor(ratio_amino[, interested_par], levels = as.character(subset(ratio_amino_sort, vartypes == "Disease")[, interested_par]))
  
  # for aa_change
  ratio_amino <- subset(ratio_amino, pvalue < 0.05 & estimate > 0 & is.finite(estimate) & vartypes %in% c("Disease", "Polymorphism"))
  common_change <- intersect(subset(ratio_amino, vartypes == "Disease")$aa_change, subset(ratio_amino, vartypes == "Polymorphism")$aa_change)
  ratio_amino <- subset(ratio_amino, aa_change %in% common_change)
  
  ggplot(subset(ratio_amino, vartypes %in% c("Disease", "Polymorphism")), aes_string(x = interested_par, y = "estimate", ymin = "ci_low", ymax = "ci_up")) + geom_pointrange(aes(col = vartypes), position=position_dodge(width=0.30))  + ylab("Odds ratio & 95% CI") + geom_hline(aes(yintercept = 1)) + xlab("") + scale_y_log10()  
  ggsave(filename = "tmp.pdf", height=3, width=12)
  
  ratio_amino
}
ratio_amino <- aa_change_preference(protein_annotate_onlysnp, "aa_change")
aa_change_preference <- function(p_annotate_bs, interested_par){
  aa_change <- factor(unique(p_annotate_bs[,interested_par]))
  vartypes   = c("Disease", "Polymorphism", "Unclassified")
  ratio_amino <- data.frame(merge(aa_change, vartypes, all = TRUE))
  colnames(ratio_amino) <- c(interested_par, "vartypes")
  print(ratio_amino)
  for (vartype in vartypes) {
    for (each in aa_change){
      
      print(each)
      print(vartype)
      
      cannot_proc <- F
      
      oddsratio_fun <- function(d, i) {
        or <- fisher.test(table(data.frame(residueName = (d[i,interested_par] == each), Disease = d[i, "VarType"] == vartype)))$estimate[[1]]
        or
      }
      
      oddsboot <- tryCatch({
        boot(p_annotate_bs, oddsratio_fun, R = 100, parallel = "multicore")
        
      }, error = function(err) { cannot_proc <<- T })
      
      oddsci   <- tryCatch({
        boot.ci(oddsboot, type = "norm")
      }, error = function(err) { cannot_proc <<- T })
      
      if (cannot_proc) {
        next
      }
      
      print(oddsci)
      
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"estimate"] = oddsci$t0
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"ci_low"] = oddsci$normal[2]
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"ci_up"] = oddsci$normal[3]
    }
  }
  
  print(ratio_amino)
  # plot the graph
  ratio_amino_sort <- ratio_amino[with(ratio_amino, order(-estimate)),]
  ratio_amino[, interested_par] <- factor(ratio_amino[, interested_par], levels = as.character(subset(ratio_amino_sort, vartypes == "Disease")[, interested_par]))
  
  # for aa_change
  ratio_amino <- subset(ratio_amino, (ci_low - 1) * (ci_up - 1) > 0 & estimate > 0 & is.finite(estimate) & vartypes %in% c("Disease", "Polymorphism"))
  common_change <- intersect(subset(ratio_amino, vartypes == "Disease")$aa_change, subset(ratio_amino, vartypes == "Polymorphism")$aa_change)
  ratio_amino <- subset(ratio_amino, aa_change %in% common_change)
  
  ggplot(subset(ratio_amino, vartypes %in% c("Disease", "Polymorphism")), aes_string(x = interested_par, y = "estimate", ymin = "ci_low", ymax = "ci_up")) + geom_pointrange(aes(col = vartypes), position=position_dodge(width=0.30))  + ylab("Odds ratio & 95% CI") + geom_hline(aes(yintercept = 1)) + xlab("") + scale_y_log10()  
  ggsave(filename = "tmp.pdf", height=3, width=12)
  
  ratio_amino
}
ratio_amino <- aa_change_preference(protein_annotate_onlysnp, "aa_change")
aa_change_preference <- function(p_annotate_bs, interested_par){
  aa_change <- factor(unique(p_annotate_bs[,interested_par]))
  vartypes   = c("Disease", "Polymorphism", "Unclassified")
  ratio_amino <- data.frame(merge(aa_change, vartypes, all = TRUE))
  colnames(ratio_amino) <- c(interested_par, "vartypes")
  print(ratio_amino)
  for (vartype in vartypes) {
    for (each in aa_change){
      
      cannot_proc <- F
      
      oddsratio_fun <- function(d, i) {
        or <- fisher.test(table(data.frame(residueName = (d[i,interested_par] == each), Disease = d[i, "VarType"] == vartype)))$estimate[[1]]
        or
      }
      
      oddsboot <- tryCatch({
        boot(p_annotate_bs, oddsratio_fun, R = 1000, parallel = "multicore")
        
      }, error = function(err) { cannot_proc <<- T })
      
      oddsci   <- tryCatch({
        boot.ci(oddsboot, type = "norm")
      }, error = function(err) { cannot_proc <<- T })
      
      if (cannot_proc) {
        next
      }
      
      print(oddsci)
      
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"estimate"] = oddsci$t0
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"ci_low"] = oddsci$normal[2]
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"ci_up"] = oddsci$normal[3]
    }
  }
  
  print(ratio_amino)
  # plot the graph
  ratio_amino_sort <- ratio_amino[with(ratio_amino, order(-estimate)),]
  ratio_amino[, interested_par] <- factor(ratio_amino[, interested_par], levels = as.character(subset(ratio_amino_sort, vartypes == "Disease")[, interested_par]))
  
  # for aa_change
  ratio_amino <- subset(ratio_amino, (ci_low - 1) * (ci_up - 1) > 0 & estimate > 0 & is.finite(estimate) & vartypes %in% c("Disease", "Polymorphism"))
  common_change <- intersect(subset(ratio_amino, vartypes == "Disease")$aa_change, subset(ratio_amino, vartypes == "Polymorphism")$aa_change)
  ratio_amino <- subset(ratio_amino, aa_change %in% common_change)
  
  ggplot(subset(ratio_amino, vartypes %in% c("Disease", "Polymorphism")), aes_string(x = interested_par, y = "estimate", ymin = "ci_low", ymax = "ci_up")) + geom_pointrange(aes(col = vartypes), position=position_dodge(width=0.30))  + ylab("Odds ratio & 95% CI") + geom_hline(aes(yintercept = 1)) + xlab("") + scale_y_log10()  
  ggsave(filename = "tmp.pdf", height=3, width=12)
  
  ratio_amino
}
ratio_amino <- aa_change_preference(protein_annotate_onlysnp, "aa_change")
unique(protein_annotate_withsnp$UniProtID)
length(unique(subset(protein_annotate_withsnp, VarType == "Disease")$UniProtID))
length(unique(subset(protein_annotate_withsnp, VarType == "Polymorphism")$UniProtID))
length(unique(subset(protein_annotate_withsnp, VarType == "Unclassified")$UniProtID))
protein_annotate<- read.table("./Data/SNPOnStruct_final_8.txt", sep = "\t", header = F, quote = "", na.string = "\\N")
#
colnames(protein_annotate)<-c("pdbid", "biounit", "ModelID", "chainid", "resnam", "resnum", "structcode", "ssa", "rsa", "UniProtID", "uniprot_resnam", "uniprot_resnum", "bs_biounit", "bs_p_chainid", "bs_p_resnum", "ligandName", "BindingSiteComment", "distance", "genename", "SwissProt_AC", "FTID", "AABefore", "prot_resnum", "AAAfter", "VarType", "dbSNPID", "DiseaseName", "uniprot_resnam_3d", "AABeforeProp", "AAAfterProp", "proteinname", "reviewed", "gene_name_acc", "interproname_acc")
protein_annotate$location = "Core"
#MAX_ACC["GLY"] = 84.0
protein_annotate$location[protein_annotate$ssa > 5] = "Surface"
protein_annotate[ which(protein_annotate$distance <= 4.0 | !is.na(protein_annotate$BindingSiteComment)),'location'] = "Binding Site"
snp_num = ddply(protein_annotate, .(UniProtID), summarise, N = length(unique(uniprot_resnum[!is.na(VarType)])))
protein_annotate_withsnp = subset(protein_annotate, UniProtID %in% factor(unique(subset(protein_annotate, !is.na(VarType))$UniProtID)))
length(unique(protein_annotate_withsnp$UniProtID))
length(unique(subset(protein_annotate_withsnp, VarType == "Disease")$UniProtID))
length(unique(subset(protein_annotate_withsnp, VarType == "Polymorphism")$UniProtID))
length(unique(subset(protein_annotate_withsnp, VarType == "Unclassified")$UniProtID))
length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Disease"))$UniProtID))
disease =  245
polymor =  580
unclass =  149
dis_pol =  length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Disease"))$UniProtID))
pol_unc =  length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Unclassified"))$UniProtID))
dis_unc =  length(unique(subset(protein_annotate_withsnp, VarType %in% c("Unclassified", "Disease"))$UniProtID))
dis_unc
install.packages("VennDiagram")
library(VennDiagram)
library(VennDiagram)
install.packages("VennDiagram")
library(VennDiagram)
library(VennDiagram)
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.col=c("red", "blue", "orange"), cat.pos = 3)
dev.off()
dev.off()
disease =  245
polymor =  580
unclass =  149
dis_pol =  disease + polymor - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Disease"))$UniProtID))
pol_unc =  polymor + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Unclassified"))$UniProtID))
dis_unc =  disease + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Unclassified", "Disease"))$UniProtID))
dis_unc_poly = disease + unclass + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Unclassified", "Disease", "Unclassified"))$UniProtID))
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.col=c("red", "blue", "orange"), cat.pos = 3)
dev.off()
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.col=c("red", "blue", "orange"), cat.pos = 3)
dis_unc_poly
disease =  245
polymor =  580
unclass =  149
dis_pol =  disease + polymor - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Disease"))$UniProtID))
pol_unc =  polymor + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Unclassified"))$UniProtID))
dis_unc =  disease + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Unclassified", "Disease"))$UniProtID))
dis_unc_poly = (disease + unclass + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Unclassified", "Disease", "Unclassified"))$UniProtID))) / 2
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.col=c("red", "blue", "orange"), cat.pos = 3)
dev.off()
dev.off()
dis_pol =  disease + polymor - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Disease"))$UniProtID))
pol_unc =  polymor + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Unclassified"))$UniProtID))
dis_unc =  disease + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Unclassified", "Disease"))$UniProtID))
dis_unc_poly = (disease + polymor + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Unclassified", "Disease", "Unclassified"))$UniProtID))) / 2
dis_unc_poly
all_vartype <- protein_annotate_withsnp %>%
  group_by(UniProtID) %>%
  summarise(vartype_n = n_distinct(VarType)) %>%
  filter(vartype_n > 2)
names(all_vartype)
all_vartype
dim(all_vartype)
unique(protein_annotate_withsnp$VarType)
all_vartype <- protein_annotate_withsnp %>%
  group_by(UniProtID) %>%
  summarise(vartype_n = n_distinct(VarType)) %>%
  filter(vartype_n > 3)
dim(all_vartype)
dis_pol =  disease + polymor - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Disease"))$UniProtID))
pol_unc =  polymor + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Polymorphism", "Unclassified"))$UniProtID))
dis_unc =  disease + unclass - length(unique(subset(protein_annotate_withsnp, VarType %in% c("Unclassified", "Disease"))$UniProtID))
dis_unc_poly = 41
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.col=c("red", "blue", "orange"), cat.pos = 3)
dev.off()
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.col=c("red", "blue", "orange"))
dev.off()
 paste("Num", 1:100)
venn.plot <- venn.diagram( x = list("Disease" = unique(subset(protein_annotate_withsnp, VarType == "Disease")$UniProtID), "Polymorphism" = unique(subset(protein_annotate_withsnp, VarType == "Polymorphism")$UniProtID), "Unclassified" = unique(subset(protein_annotate_withsnp, VarType == "Unclassified")$UniProtID)), filename = "Euler_3set_simple.tiff")
venn.plot <- venn.diagram( x = list("Disease" = unique(subset(protein_annotate_withsnp, VarType == "Disease")$UniProtID), "Polymorphism" = unique(subset(protein_annotate_withsnp, VarType == "Polymorphism")$UniProtID), "Unclassified" = unique(subset(protein_annotate_withsnp, VarType == "Unclassified")$UniProtID)), filename = "vennplot.pdf")
install.packages("grDevices")
unique(subset(protein_annotate_withsnp, VarType == "Disease")$UniProtID)
pdf("vennplot.pdf", width = 8)
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.col=c("red", "blue", "orange"))
dev.off()
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.dist = c(0.05, 0.05, 0.025), cat.col=c("red", "blue", "orange"))
dev.off()
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.dist = c(0.05, 0, 0.025), cat.col=c("red", "blue", "orange"))
dev.off()
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.pos = c(-40, 35, 180), cat.col=c("red", "blue", "orange"))
dev.off()
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.pos = c(-40, 34, 180), cat.col=c("red", "blue", "orange"))
dev.off()
pdf("vennplot.pdf")
venn.plot <- draw.triple.venn(disease, polymor, unclass, dis_pol, pol_unc, dis_unc, dis_unc_poly, category = c("Disease", "Polymorphism", "Unclassified"), fill = c("red", "blue", "orange"), cex = 2, cat.cex=2, cat.pos = c(-40, 32, 180), cat.col=c("red", "blue", "orange"))
dev.off()
subset(protein_annotate_withsnp, UniProtID == "P04637") 
dim(subset(protein_annotate_withsnp, UniProtID == "P04637"))
with(subset(protein_annotate_withsnp, UniProtID == "P04637"), table(location))
with(subset(protein_annotate_withsnp, UniProtID == "P04637"), table(location, VarType))
with(subset(protein_annotate_withsnp, UniProtID == "P04637" & VarType == "Unclassified"), table(location, UniProtID))
with(subset(protein_annotate_withsnp, UniProtID == "P04637" & VarType == "Unclassified"), table(location, factor(UniProtID)))
with(subset(protein_annotate_withsnp, VarType == "Unclassified"), table(location, factor(UniProtID)))
with(subset(protein_annotate_withsnp, VarType == "Unclassified"), table(location, factor(UniProtID)))
subset(allo_site, table(UniProtID, allosite))
with(allo_site, table(UniProtID, allosite))
with(allo_site, table(factor(UniProtID), allosite))
dis_pol / disease
count(unique(protein_annotate_withsnp$UniProtID))
count(unique(factor(protein_annotate_withsnp$UniProtID)))
count(unique(as.charactor(protein_annotate_withsnp$UniProtID)))
count(unique(as.character(protein_annotate_withsnp$UniProtID)))
names(protein_annotate_withsnp)
count(unique(protein_annotate_withsnp$UniProtID))
length(unique(protein_annotate_withsnp$UniProtID))
114/697
83/697
67/697
63/697
35/697
20/697
allo_site
names(allo_site)
unique(allo_site$allosite)
unique(with(allo_site, VarType == "Unclassified"))
unique(subset(allo_site, allosite == Allo & VarType == "Unclassified"))
unique(subset(allo_site, allosite == "Allo" & VarType == "Unclassified"))
unique(subset(allo_site, allosite == "Allo" & VarType == "Unclassified")$UniProtID)
with(subset(allo_site, allosite == "Allo" & VarType == "Unclassified"), tableÃ¯Â¼ÂˆÃ¯Ã¯Â¼ÂˆÃe(UniProtID, VarType))
with(subset(allo_site, allosite == "Allo" & VarType == "Unclassified"), table(UniProtID, VarType))
with(subset(allo_site, allosite == "Allo" & VarType == "Unclassified"), table(factor(UniProtID), VarType))
with(subset(allo_site, allosite == "Allo"), table(factor(UniProtID), VarType))
with(allo_site, table(factor(UniProtID), VarType, allosite))
with(allo_site, table(factor(UniProtID), VarType))
sc_volumn = data.frame(AAName = c("ALA","CYS","ASP","GLU","PHE","GLY","HIS","ILE","LYS","LEU","MET","ASN","PRO","GLN","ARG","SER","THR","VAL","TRP","TYR"), volumn = c(106.0,135.0,163.0,194.0,197.0,84.0,184.0,169.0,205.0,164.0,188.0,157.0,136.0,198.0,248.0,130.0,142.0,142.0,227.0,222.0))
sc_volumn$volumn.c = cut(sc_volumn$volumn, breaks=3, label = c("small", "medium", "large"))
protein_annotate_onlysnp$volumn_change <- apply(protein_annotate_onlysnp, 1, function(x) { paste(as.character(sc_volumn[sc_volumn$AAName == x[["AABefore"]], "volumn.c"]), "to", as.character(sc_volumn[sc_volumn$AAName == x[["AAAfter"]], "volumn.c"]))})
ratio_amino <- aa_change_preference(protein_annotate_onlysnp, "volumn_change")
aa_change_preference <- function(p_annotate_bs, interested_par){
  aa_change <- factor(unique(p_annotate_bs[,interested_par]))
  vartype = "Disease"
  vartypes   = c("Disease", "Polymorphism", "Unclassified")
  ratio_amino <- data.frame(merge(aa_change, vartypes, all = TRUE))
  colnames(ratio_amino) <- c(interested_par, "vartypes")
  for (vartype in vartypes) {
    for (each in aa_change){
      each = as.character(each)
      table_res <- table(deal_with_na(p_annotate_bs$VarType == vartype),
                         deal_with_na(as.character(p_annotate_bs[,interested_par]) == each))
      table_res <- apply(table_res, 1:2, as.numeric)
      rownames(table_res) <- c(paste("Not", vartype), vartype)
      colnames(table_res) <- c(paste("Not", each), each)
      
      fish_result = fisher.test(table(data.frame(residueName = (p_annotate_bs[,interested_par] == each), Disease = p_annotate_bs$VarType == vartype)))
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"estimate"] = fish_result$estimate
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"ci_low"] = fish_result$conf.int[1]
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"ci_up"] = fish_result$conf.int[2]
      ratio_amino[ratio_amino[,interested_par] == each & ratio_amino$vartypes == vartype,"pvalue"] = fish_result$p.value
    }
  }
  ratio_amino
}
ratio_amino <- aa_change_preference(protein_annotate_onlysnp, "volumn_change")
ratio_amino_sort <- ratio_amino[with(ratio_amino, order(-estimate)),]
ratio_amino$volumn_change <- factor(ratio_amino$volumn_change, levels = as.character(subset(ratio_amino_sort, vartypes == "Disease")$volumn_change))
ggplot(subset(ratio_amino, vartypes %in% c("Disease", "Polymorphism")), aes(x = volumn_change, y = estimate, ymin = ci_low, ymax = ci_up)) + geom_pointrange(aes(col = vartypes), position=position_dodge(width=0.30))  + ylab("Odds ratio & 95% CI") + geom_hline(aes(yintercept = 1)) + xlab("") + scale_y_log10() + theme(axis.text.x = element_text( size=10))
ggsave(filename = "tmp.pdf", height=4, width=12) 
ratio_amino <- aa_change_preference(subset(protein_annotate_onlysnp, location == "Binding Site"), "volumn_change")
############################Plot odds ratio######################################
ratio_amino_sort <- ratio_amino[with(ratio_amino, order(-estimate)),]
ratio_amino$volumn_change <- factor(ratio_amino$volumn_change, levels = as.character(subset(ratio_amino_sort, vartypes == "Disease")$volumn_change))
ggplot(subset(ratio_amino, vartypes %in% c("Disease", "Polymorphism")), aes(x = volumn_change, y = estimate, ymin = ci_low, ymax = ci_up)) + geom_pointrange(aes(col = vartypes), position=position_dodge(width=0.30))  + ylab("Odds ratio & 95% CI") + geom_hline(aes(yintercept = 1)) + xlab("") + scale_y_log10() + theme(axis.text.x = element_text( size=10))
ggsave(filename = "tmp.pdf", height=4, width=12) 
model <- lm(is_disease ~ hydro_change + size_change, data = protein_annotate_onlysnp)
summary(model)
model <- lm(is_disease ~ hydro_change + size_change + location, data = protein_annotate_onlysnp)
summary(model)
model <- glm(is_disease ~ hydro_change + size_change + location, data = protein_annotate_onlysnp)
summary(model)
predict(modelpre_result <- predict(model))
pre_result <- predict(model)
pre_result
summary(model)
pred <- prediction(pre_result, protein_annotate_onlysnp$is_disease)
perf <- performance(pred, measure = "tpr", x.measure = "fpr") 
plot(perf, col=rainbow(10))
install.packages("ROCR")
names(protein_annotate_onlysnp)
q()
ecfp6 <- read.csv("/users/ahmedaq/work/DrugRep/DrugCombined/Similarity/06_CominedDrugLigandSimilarity_May2015_cutoff0.2_clean.tab", sep = "\t", header = F)
mdlkey <- read.csv("/users/ahmedaq/work/DrugRep/DrugCombined/Similarity/06_CominedDrugLigandSimilarity_May2015_cutoff0.6_MDLkey_clean.tab", sep = "\t", header = F)
colnames(ecfp6) <- c("drug_id", "sim", "lig_id")
colnames(mdlkey) <- c("drug_id", "sim", "lig_id")
join_data = merge(ecfp6, mdlkey, by=c("drug_id", "lig_id"))
names(join_datda)
names(join_data)
colnames(join_data) <- c("drug_id","lig_id","ECFP6","MDLKey" )
summary(join_datda)
summary(join_data)
subset(join_data, ECFP6 == 1 & MDLKey < 0.7)
subset(join_data, ECFP6 == 1 & MDLKey < 0.7)
library(ascii)
install.packages(ascii)
install.packages("ascii")
ascii(subset(join_data, ECFP6 == 1 & MDLKey < 0.7))
library(ascii)
ascii(subset(join_data, ECFP6 == 1 & MDLKey < 0.7))
ascii(subset(join_data, ECFP6 < 0. 3 & MDLKey == 1))
dim(subset(join_data, ECFP6 < 0. 3 & MDLKey == 1))
dim(subset(join_data, ECFP6 < 0.3 & MDLKey == 1))
ascii(subset(join_data, ECFP6 < 0.3 & MDLKey == 1))
ascii(subset(join_data, ECFP6 < 0.2 & MDLKey == 1))
ascii(subset(join_data, ECFP6 < 0.25 & MDLKey == 1))
ascii(subset(join_data, ECFP6 < 0.2 & MDLKey < 0.98 & MDLKey > 0.96))
ascii(subset(join_data, ECFP6 < 0.2 & MDLKey < 1 & MDLKey > 0.96))
ascii(subset(join_data, ECFP6 < 0.4 & MDLKey < 1 & MDLKey > 0.96))
ascii(subset(join_data, ECFP6 < 0.3 & MDLKey < 1 & MDLKey > 0.96))
ascii(subset(join_data, ECFP6 < 0.25 & MDLKey < 1 & MDLKey > 0.96))
ascii(subset(join_data, ECFP6 < 0.25 & MDLKey < 0.98 & MDLKey > 0.96))
colnames(join_data) <- c("lig_id","drug_id","ECFP6","MDLKey" )
ascii(subset(join_data, ECFP6 < 0.25 & MDLKey < 0.98 & MDLKey > 0.96))
ascii(subset(join_data, MDLKey < 0.7 & ECFP6 < 0.7 & ECFP6 > 0.6))
ascii(subset(join_data, MDLKey < 0.75 & ECFP6 < 0.7 & ECFP6 > 0.6))
ascii(subset(join_data, MDLKey < 0.65 & ECFP6 < 0.7 & ECFP6 > 0.6))
ascii(subset(join_data, MDLKey > 0.63 & MDLKey < 0.65 & ECFP6 < 0.7 & ECFP6 > 0.6))
ascii(subset(join_data, MDLKey > 0.64 & MDLKey < 0.65 & ECFP6 < 0.7 & ECFP6 > 0.6))
ascii(subset(join_data, MDLKey == 0.81 & ECFP6 == 0.3))
ascii(subset(join_data, MDLKey == 0.81 & ECFP6 == 0.31))
ascii(subset(join_data, MDLKey == 0,81 & ECFP6 < 0.4))
ascii(subset(join_data, MDLKey == 0.81 & ECFP6 < 0.4))
ascii(subset(join_data, MDLKey == 0.81 & ECFP6 == 0.33))
ascii(subset(join_data, MDLKey == 0.81 & ECFP6 < 0.4 & ECFP > 0.33))
ascii(subset(join_data, MDLKey == 0.81 & ECFP6 < 0.4 & ECFP6 > 0.33))
ascii(subset(join_data, MDLKey > 0.8 & MDLKey < 0.9 & ECFP6 < 0.4 & ECFP6 > 0.33))
round(0.33,  2)
round(0.33,  1)
ascii(subset(join_data, round(ECFP6, 2) == 0.33 & MDLKey < 0.9 & MDLKey > 0.8))
ascii(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) < 0.81))
ascii(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.81))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.81)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.82)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.83)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.84)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.85)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.86)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.87)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.88)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.89)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.33 & round(MDLKey,2) == 0.9)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.4 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.41 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.42 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.43 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.44 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.45 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.46 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.47 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.48 & round(MDLKey,2) == 0.75)))
ascii(head(subset(join_data, round(ECFP6, 2) == 0.49 & round(MDLKey,2) == 0.75)))
dim(join_data)
join_data = merge(ecfp6, mdlkey, by=c("drug_id", "lig_id"), all = T)
join_data[is.na(d)] <- 0
dim(join_data)
head(join_data)
join_data[is.na(join_data)] <- 0
colnames(join_data) <- c("lig_id","drug_id","ECFP6","MDLKey" )
join_data$max_sim <- max(join_data$ECFP6, join_data$MDLKey)
write.table(join_data, filename = "join_sim.txt", sep = "\t")
write.table(join_data, file = "join_sim.txt", sep = "\t")
head(join_data)
max(join_data$ECFP6[1])
max(join_data$ECFP6[1], join_data$MDLKey[1])
max_sim = max(cbind(join_data$ECFP6, join_data$MDLKey))
dim(max_sim)
length(max_sim)
dim(cbind(join_data$ECFP6, join_data$MDLKey))
max_sim = apply(cbind(join_data$ECFP6, join_data$MDLKey), 1 max)
max_sim = apply(cbind(join_data$ECFP6, join_data$MDLKey), 1, max)
len(max_sim)
length(max_sim)
join_data = merge(ecfp6, mdlkey, by=c("drug_id", "lig_id"))
colnames(join_data) <- c("lig_id","drug_id","ECFP6","MDLKey" )
join_data$max_sim = apply(cbind(join_data$ECFP6, join_data$MDLKey), 1, max)
head(join_data)
?write.table
write.table(join_data, file = "join_sim.txt", row.names = F)
write.table(join_data, file = "join_sim.txt", row.names = F, sep="\t")
oin_data = merge(ecfp6, mdlkey, by=c("drug_id", "lig_id"), all = T)
join_data = merge(ecfp6, mdlkey, by=c("drug_id", "lig_id"), all = T)
colnames(join_data) <- c("lig_id","drug_id","ECFP6","MDLKey" )
join_data[is.na(join_data)] <- 0
join_data$max_sim = apply(cbind(join_data$ECFP6, join_data$MDLKey), 1, max)
write.table(join_data, file = "join_sim.txt", row.names = F, sep="\t")
head(join_data)
ls(
)
q()
cosmic <- read.table("/users/ajing/SNPDist/Data/humsavar_tru.txt.out_test", sep = "\t", header = T, quote = "", na.string = "-")
head(cosmic)
cosmic <- read.table("/users/ajing/SNPDist/Data/CosmicCompleteExport.tsv", sep = "\t", header = T, quote = "", na.string = "-")
head(cosmic)
summary(cosmic)
cosmic <- read.table("/users/ajing/SNPDist/Data/CosmicCompleteExport.tsv", sep = "\t", header = T, quote = "", na.string = "")
head(cosmic)
head(cosmic$Mutation.CDS)
head(cosmic$Mutation.CDS[1])
is.na(cosmic$Mutation.CDS[1])
summary(cosmic)
table(cosmic$Mutation.CDS)
summary(cosmic)
mic_missense <- subset(cosmis, Mutation.Description == "Substitution - Missense")
cosmic_missense <- subset(cosmic, Mutation.Description == "Substitution - Missense")
summary(cosmic_missense)
cosmic_missense$Mutation.AA.Before <- apply(cosmic_missense, 1, function(x){(str_sub(x[["Mutation.AA"]], 3, 4)}) 
cosmic_missense$Mutation.AA.Before <- apply(cosmic_missense, 1, function(x){str_sub(x[["Mutation.AA"]], 3, 4)}) 
substring()
cosmic_missense$Mutation.AA.Before <- apply(cosmic_missense, 1, function(x){substring(x[["Mutation.AA"]], 3, 4)}) 
cosmic_missense$Mutation.AA.Before <- apply(cosmic_missense, 1, function(x){str_sub(x[["Mutation.AA"]], 3, 4)}) 
library("stringr")
cosmic_missense$Mutation.AA.Before <- apply(cosmic_missense, 1, function(x){str_sub(x[["Mutation.AA"]], 3, 3)}) 
cosmic_missense$Mutation.AA.After <- apply(cosmic_missense, 1, function(x){str_sub(x[["Mutation.AA"]], -1, -1)}) 
summary(cosmic_missense)
cosmic_missense$Mutation.AA.Before <- factor(cosmic_missense$Mutation.AA.Before)
cosmic_missense$Mutation.AA.After <- factor(cosmic_missense$Mutation.AA.After)
cosmic_missense$Mutation.AA.resnum <- apply(cosmic_missense, 1, function(x){as.numeric(str_sub(x[["Mutation.AA"]], 4, -2))}) 
warnings()
summary(cosmic_missense)
tables(cosmic_missense$Mutation.AA.After)
table(cosmic_missense$Mutation.AA.After)
table(cosmic_missense$Mutation.AA.Before)
table(cosmic_missense$Mutation.AA)
summary(cosmic_missense)
unique(cosmic_missense$Mutation.AA.After)
aa_list <- c("R", "Q", "K", "V", "C", "Y", "D", "P", "I", "L", "A", "N", "H", "M", "T", "F", "W", "S", "E", "G", "Z")
cosmic_missense <- subset(cosmic_missense, !is.na(Mutation.AA.resnum) & Mutation.AA.Before %in% aa_list & Mutation.AA.After %in% aa_list)
summary(cosmic_missense)
cosmic_missense$Mutation.AA.Before <- factor(cosmic_missense$Mutation.AA.Before)
cosmic_missense$Mutation.AA.After <- factor(cosmic_missense$Mutation.AA.After)
summary(cosmic_missense)
rm(cosmic)
dist_each_gene <- merge(cosmic_missense, cosmic_missense, by = "Gene.name")
cosmic_missense$Mutation.AA.Before <- factor(cosmic_missense$Mutation.AA.Before)
cosmic_missense$Mutation.AA.After <- factor(cosmic_missense$Mutation.AA.After)
summary(cosmic_missense)
dim(cosmic_missense)
ls()
